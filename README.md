# BoxBloom

一个轻量级的Love2D演示项目，展示了使用盒型滤波（Box Filters）实现的泛光（Bloom）效果。

## 项目说明

本项目实现了基于盒型滤波的高效模糊算法，相比传统的高斯模糊，具有以下优势：
- 采样次数与模糊半径无关，固定为有限次数
- 在移动端等性能受限设备上表现更佳
- 视觉效果与高斯模糊相近

## 使用方法

- 上/下箭头键：调整亮度阈值
- 左/右箭头键：调整模糊半径
- +/-键：调整泛光强度
- 拖动中间白线：比较原图与效果图

## 实现原理

传统的高斯模糊需要对每个像素周围进行大量采样，采样次数随模糊半径增加而增加。盒型滤波通过模拟不同级别的mipmap采样，使得采样次数只与模拟的级别数量相关，而与模糊半径无关。

## 概要说明
盒型滤波着色器代码原理解析
这段代码实现了一个基于论文《The Power of Box Filters》的盒型滤波算法，用于图像模糊处理。我来详细解释一下它的工作原理：

核心思想
传统的高斯模糊需要对每个像素周围大量采样，采样次数与模糊半径成正比。例如，模糊半径为10时，需要对每个像素周围约21×21=441个像素进行采样，这在移动设备上性能开销很大。

盒型滤波的核心思想是：不管模糊半径多大，采样次数保持不变。它通过模拟不同级别的mipmap采样来实现这一点。

代码实现原理
多级采样策略：

代码中实现了3个不同的采样级别，分别对应不同的采样范围
每个级别使用不同的步长(step)，步长随级别增加而增大
级别1：小范围采样(3×3)，步长为基础步长
级别2：中范围采样(5×5)，步长为基础步长的4倍
级别3：大范围采样(5×5)，步长为基础步长的16倍
权重计算：

float weight = exp(-power / (2.0 * 3.14159 * sigma * sigma)) / power;
这个公式基于论文中的权重计算公式简化而来
power是4的level次方(4^level)
权重随着级别增加而减小，高级别(更大范围)的采样对最终结果贡献较小
sigma基于模糊半径计算，控制权重的分布
采样与累加：

每个级别内进行均匀采样，计算平均值
将各级别的结果按权重累加
最后对结果进行归一化处理
与传统高斯模糊的区别
采样效率：

传统高斯模糊：采样次数 ∝ 模糊半径²
盒型滤波：采样次数固定(本例中约为3×3 + 5×5 + 5×5 = 59次)
性能特点：

当模糊半径较小时，传统高斯模糊可能更快
当模糊半径较大时，盒型滤波明显更高效
盒型滤波特别适合移动设备和需要大半径模糊的场景
视觉效果：

盒型滤波的结果与高斯模糊非常接近
在大多数实际应用中，很难区分两者的差异
代码优化考虑
这个实现是为了兼容LÖVE引擎的GLSL限制而特别简化的版本：

避免了数组和循环，使用硬编码的采样级别
使用浮点数代替整数，避免类型转换问题
减少了数学计算的复杂度
在更现代的GPU和着色器环境中，可以使用更灵活的实现，包括动态级别数量和更精确的权重计算。


## 论文出处

本项目基于以下论文实现：
[The Power of Box Filters: Real-time Approximation to Large Convolution Kernel by Box-filtered Image Pyramid](https://www.researchgate.net/publication/337301359_The_Power_of_Box_Filters_Real-time_Approximation_to_Large_Convolution_Kernel_by_Box-filtered_Image_Pyramid)

